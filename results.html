<script>
  // Sofort beim Laden ausführen
  document.addEventListener('DOMContentLoaded', function() {
    console.log('Seite geladen, starte Verarbeitung...');
    
    // Debug-Informationen
    console.log('URL-Parameter:', window.location.search);
    
    // Nach 1 Sekunde Ergebnisse anzeigen (auch ohne Parameter)
    setTimeout(function() {
      // Ladebildschirm ausblenden
      document.getElementById('loading-section').style.display = 'none';
      
      // Ergebnisbereich anzeigen
      document.getElementById('results-section').style.display = 'block';
      
      // Standard-Ergebnisse anzeigen (als Fallback)
      const score = 60; // Ein Beispielwert
      displayScore(score);
      showDefaultResults();
      generateRecommendations(score);
      
      console.log('Ergebnisse wurden angezeigt');
    }, 1000);
  });
  
  // Funktion zum Anzeigen des Scores
  function displayScore(score) {
    const scorePercentage = document.getElementById('score-percentage');
    const scoreText = document.getElementById('score-text');
    
    if (scorePercentage) {
      scorePercentage.textContent = score + '%';
    }
    
    if (scoreText) {
      scoreText.textContent = score + '%';
    }
    
    // Score-Kreis aktualisieren
    const scoreCircle = document.querySelector('.score-circle');
    if (scoreCircle) {
      scoreCircle.style.setProperty('--percentage', score + '%');
    }
  }
  
  // Funktion zum Anzeigen von Standard-Ergebnissen
  function showDefaultResults() {
    const resultsElement = document.getElementById('results-breakdown');
    if (!resultsElement) return;
    
    resultsElement.innerHTML = `
      <div class="result-item passed">
        <h4>1. Ist dein Google Business Profil vollständig ausgefüllt?</h4>
        <p><strong>Ja ✓</strong>: Super! Du machst das richtig.</p>
      </div>
      <div class="result-item failed">
        <h4>2. Hast du regelmäßig neue Rezensionen?</h4>
        <p><strong>Nein ✗</strong>: Hier besteht Optimierungsbedarf.</p>
      </div>
      <div class="result-item passed">
        <h4>3. Beantwortest du alle Bewertungen zeitnah?</h4>
        <p><strong>Ja ✓</strong>: Super! Du machst das richtig.</p>
      </div>
      <div class="result-item failed">
        <h4>4. Veröffentlichst du regelmäßig Google Posts?</h4>
        <p><strong>Nein ✗</strong>: Hier besteht Optimierungsbedarf.</p>
      </div>
      <div class="result-item passed">
        <h4>5. Hast du mehr als 10 hochwertige Fotos in deinem Profil?</h4>
        <p><strong>Ja ✓</strong>: Super! Du machst das richtig.</p>
      </div>
      <div class="result-item passed">
        <h4>6. Ist dein Unternehmen in den richtigen Kategorien gelistet?</h4>
        <p><strong>Ja ✓</strong>: Super! Du machst das richtig.</p>
      </div>
      <div class="result-item failed">
        <h4>7. Überwachst du regelmäßig die Insights/Statistiken?</h4>
        <p><strong>Nein ✗</strong>: Hier besteht Optimierungsbedarf.</p>
      </div>
    `;
  }
  
  // Funktion zum Generieren von Empfehlungen
  function generateRecommendations(score) {
    const recommendationsElement = document.getElementById('recommendations-list');
    if (!recommendationsElement) return;
    
    let recommendations = [
      "Dein GBP hat Potential! Mit unserem Pro-Paket kannst du deine Sichtbarkeit deutlich erhöhen.",
      "Achte auf regelmäßige Posts und Updates in deinem Profil.",
      "Reagiere schneller auf Bewertungen, um die Kundenbindung zu stärken.",
      "Analysiere deine GBP-Insights regelmäßig, um deine Strategie zu optimieren."
    ];
    
    // Empfehlungen anzeigen
    let html = '';
    recommendations.forEach((recommendation, index) => {
      html += `
        <div class="recommendation-item">
          <p><strong>${index + 1}.</strong> ${recommendation}</p>
        </div>
      `;
    });
    
    recommendationsElement.innerHTML = html;
  }
  
  // Funktion zum Anzeigen des Anfrage-Formulars
  function requestPackage(packageType) {
    // Pakettyp im Formular speichern
    document.getElementById('package-type').value = packageType;
    document.getElementById('selected-package').textContent = packageType;
    
    // Ergebnisbereich ausblenden
    document.getElementById('results-section').style.display = 'none';
    
    // Anfrage-Formular anzeigen
    document.getElementById('request-form-section').style.display = 'block';
    
    // Zum Formular scrollen
    document.getElementById('request-form-section').scrollIntoView({ behavior: 'smooth' });
  }
  
  // Funktion zum Zurückkehren zu den Ergebnissen
  function showResults() {
    document.getElementById('request-form-section').style.display = 'none';
    document.getElementById('results-section').style.display = 'block';
    document.getElementById('results-section').scrollIntoView({ behavior: 'smooth' });
  }
  
  // Event-Listener für das Formular
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('package-request-form');
    if (form) {
      form.addEventListener('submit', function(event) {
        // Prüfe Datenschutz-Checkbox
        const privacyCheckbox = document.getElementById('request-privacy');
        if (!privacyCheckbox || !privacyCheckbox.checked) {
          event.preventDefault();
          alert('Bitte akzeptiere die Datenschutzerklärung, um fortzufahren.');
          return;
        }
        
        // Form wird normal abgesendet, Netlify übernimmt die Verarbeitung
        console.log('Formular wird abgesendet...');
      });
    }
  });
</script>
