<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Deine Ergebnisse - GBP-PRO-AUDIT</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&display=swap">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>GBP-PRO-AUDIT</h1>
      <p>Professionelle Analyse deines Google Business Profils</p>
      <div class="free-badge">Kostenlos</div>
    </header>
    
    <main>
      <!-- Lade-Animation (wird automatisch ausgeblendet) -->
      <div id="loading-section" class="loading-container">
        <h2>Deine Ergebnisse werden geladen...</h2>
        <div class="loader"></div>
      </div>

      <section id="results-container" class="results-container" style="display:none;">
        <div class="results-header">
          <h2>Deine GBP-PRO-AUDIT Ergebnisse</h2>
          <p>Vielen Dank für deine Teilnahme. Hier ist deine detaillierte Analyse.</p>
        </div>
        
        <div class="score-display">
          <div class="score-circle">
            <span id="score-percentage">0%</span>
          </div>
          <p>Basierend auf deinen Antworten ist dein Google Business Profil zu <span id="score-text">0%</span> optimiert.</p>
        </div>
        
        <div class="results-details">
          <h3>Detaillierte Auswertung</h3>
          <div id="results-breakdown" class="results-list"></div>
        </div>
        
        <div class="recommendations">
          <h3>Personalisierte Empfehlungen</h3>
          <div id="recommendations-list" class="recommendations-list"></div>
        </div>
        
        <div class="packages">
          <h3>Unsere Optimierungs-Pakete</h3>
          <div class="packages-container">
            <!-- Basic-Paket -->
            <div class="package-card">
              <h4 class="package-title">Basic-Paket</h4>
              <div class="package-price">€198,99 <span class="original-price">€499</span></div>
              <p class="package-description">Starte mit einer grundlegenden Optimierung deines Google Business Profils.</p>
              <ul class="package-features">
                <li>Vollständiger GBP-PRO-AUDIT</li>
                <li>PDF-Auswertung des aktuellen Profils</li>
                <li>PDF-Optimierungsplan mit konkreten Maßnahmen</li>
                <li>30 Min. Telefon-Beratung</li>
                <li>Checkliste zur Selbstoptimierung</li>
              </ul>
              <p class="package-validity">Gültig bis 16.05.2025</p>
              <button class="package-btn btn-primary" data-package="Basic">Paket anfragen</button>
            </div>
            
            <!-- Pro-Paket -->
            <div class="package-card">
              <h4 class="package-title">Pro-Paket</h4>
              <div class="package-price">€699</div>
              <p class="package-description">Professionelle Unterstützung für dein Google Business Profil.</p>
              <ul class="package-features">
                <li>Alle Basic-Leistungen</li>
                <li>Detaillierte Wettbewerbsanalyse (PDF)</li>
                <li>Optimierung von 3 kritischen GBP-Faktoren</li>
                <li>Erweiterte Handlungsempfehlungen</li>
                <li>Priorisierungsplan für Maßnahmen</li>
                <li>60 Min. Strategie-Beratung</li>
              </ul>
              <button class="package-btn btn-primary" data-package="Pro">Paket anfragen</button>
            </div>
            
            <!-- Premium-Paket -->
            <div class="package-card">
              <h4 class="package-title">Premium-Paket</h4>
              <div class="package-price">€999</div>
              <p class="package-description">Umfassende Betreuung und Optimierung deines Google Business Profils.</p>
              <ul class="package-features">
                <li>Alle Pro-Leistungen</li>
                <li>Professionell-gestützte GBP-Komplettanalyse</li>
                <li>Monatlicher Performance-Bericht (2 Monate)</li>
                <li>Optimierung von 5 kritischen GBP-Faktoren</li>
                <li>Bewertungsmanagement-Strategie</li>
                <li>GBP-Monitoring (2 Monate)</li>
                <li>90 Min. Online-Beratung (3 x 30 Min.)</li>
              </ul>
              <button class="package-btn btn-primary" data-package="Premium">Paket anfragen</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Paket-Anfrage-Formular (anfangs versteckt) -->
      <section id="package-request-form" class="form-container" style="display: none;">
        <h2>Paket-Anfrage</h2>
        <p class="form-description">Bitte vervollständige deine Anfrage für das <span id="selected-package">Basic</span>-Paket:</p>
        
        <form name="package-request" method="POST" data-netlify="true" netlify-honeypot="bot-field">
          <!-- Netlify-spezifische Felder -->
          <input type="hidden" name="form-name" value="package-request" />
          <input type="hidden" name="package-type" id="package-type" value="Basic" />
          <p class="hidden">
            <label>Bot-Feld (nicht ausfüllen): <input name="bot-field" /></label>
          </p>
          
          <!-- Falls noch nicht vorhanden, Kontaktdaten abfragen -->
          <div id="additional-info-fields">
            <div class="form-group">
              <label for="request-name">Name:</label>
              <input type="text" id="request-name" name="name" placeholder="Dein vollständiger Name" required>
            </div>
            
            <div class="form-group">
              <label for="request-email">E-Mail:</label>
              <input type="email" id="request-email" name="email" placeholder="deine@email.de" required>
            </div>
            
            <div class="form-group">
              <label for="request-phone">Telefon:</label>
              <input type="tel" id="request-phone" name="phone" placeholder="Deine Telefonnummer" required>
            </div>
          </div>
          
          <div class="form-group">
            <label for="request-message">Nachricht (optional):</label>
            <textarea id="request-message" name="message" rows="4" placeholder="Deine Nachricht oder Fragen zum Paket"></textarea>
          </div>
          
          <div class="form-check">
            <input type="checkbox" id="request-privacy" name="privacy" required>
            <label for="request-privacy">Ich habe die <a href="datenschutz.html" target="_blank">Datenschutzerklärung</a> gelesen und stimme zu.</label>
          </div>
          
          <div class="form-submit">
            <button type="submit" class="btn btn-primary">Anfrage senden</button>
            <button type="button" class="btn btn-secondary" id="cancel-request">Zurück zu den Ergebnissen</button>
          </div>
        </form>
      </section>
    </main>
    
    <footer>
      <p>&copy; 2025 PrintMedia Grafik + Druck e.K.. Alle Rechte vorbehalten.</p>
    </footer>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Zuerst Lade-Animation anzeigen
      document.getElementById('loading-section').style.display = 'block';
      
      // Verzögerung, um die Ladeanzeige anzuzeigen
      setTimeout(function() {
        // Lade-Animation ausblenden
        document.getElementById('loading-section').style.display = 'none';
        // Ergebnisse anzeigen
        document.getElementById('results-container').style.display = 'block';
        
        // Ergebnisse verarbeiten
        processResults();
      }, 1500);
      
      // Funktion zur Verarbeitung der Ergebnisse
      function processResults() {
        // URL-Parameter auslesen
        const params = new URLSearchParams(window.location.search);
        
        // Daten aus den URL-Parametern sammeln
        const formData = {};
        for(const [key, value] of params) {
          formData[key] = value;
        }
        
        // Aus lokalem Speicher lesen (Backup)
        function getDataFromStorage() {
          try {
            const storedData = localStorage.getItem('gbp-audit-data');
            if (storedData) {
              return JSON.parse(storedData);
            }
          } catch (e) {
            console.error('Fehler beim Lesen der gespeicherten Daten:', e);
          }
          return {};
        }
        
        // Daten kombinieren
        const storedData = getDataFromStorage();
        const data = {...storedData, ...formData};
        
        // Score anzeigen
        displayScore(data);
        
        // Ergebnisse anzeigen
        displayResults(data);
        
        // Empfehlungen generieren
        generateRecommendations(data);
        
        // Event-Listener für Paket-Buttons hinzufügen
        setupPackageRequestButtons(data);
      }
      
      // Funktion zum Anzeigen des Scores
      function displayScore(data) {
        const scoreElement = document.getElementById('score-percentage');
        const scoreTextElement = document.getElementById('score-text');
        
        // Standardwert oder aus Daten
        const score = parseFloat(data['audit-score']) || getRandomScore();
        
        if (scoreElement) {
          scoreElement.textContent = `${score}%`;
        }
        
        if (scoreTextElement) {
          scoreTextElement.textContent = `${score}%`;
        }
        
        // Score-Kreis anpassen
        const scoreCircle = document.querySelector('.score-circle');
        if (scoreCircle) {
          scoreCircle.style.setProperty('--percentage', `${score}%`);
        }
        
        // Animiere den Score
        animateScore(0, score);
      }
      
      // Funktion zur Animation des Score-Wertes
      function animateScore(start, end) {
        const element = document.getElementById('score-percentage');
        if (!element) return;
        
        const duration = 1500; // Dauer der Animation in ms
        const startTime = performance.now();
        
        function updateScore(currentTime) {
          const elapsedTime = currentTime - startTime;
          
          if (elapsedTime < duration) {
            const progress = elapsedTime / duration;
            const currentScore = Math.floor(start + (end - start) * progress);
            element.textContent = `${currentScore}%`;
            requestAnimationFrame(updateScore);
          } else {
            element.textContent = `${end}%`;
          }
        }
        
        requestAnimationFrame(updateScore);
      }
      
      // Funktion zum Anzeigen der Audit-Ergebnisse
      function displayResults(data) {
        const resultsElement = document.getElementById('results-breakdown');
        if (!resultsElement) return;
        
        let auditResults;
        
        if (data['audit-results']) {
          try {
            // Versuche, die Ergebnisse als JSON zu parsen
            auditResults = JSON.parse(decodeURIComponent(data['audit-results']));
          } catch (e) {
            console.error('Fehler beim Parsen der Audit-Ergebnisse:', e);
          }
        }
        
        if (!auditResults || !Array.isArray(auditResults)) {
          // Fallback, wenn keine gültigen Ergebnisse vorliegen
          auditResults = generateDummyResults();
        }
        
        // HTML für die Ergebnisse erstellen
        let resultsHTML = '';
        auditResults.forEach((item, index) => {
          resultsHTML += `
            <div class="result-item ${item.passed ? 'passed' : 'failed'}">
              <h4>${index + 1}. ${item.question || 'Unbekannte Frage'}</h4>
              <p><strong>${item.passed ? 'Ja ✓' : 'Nein ✗'}</strong>: ${item.explanation || ''}</p>
            </div>
          `;
        });
        
        // In das DOM einfügen
        resultsElement.innerHTML = resultsHTML;
      }
      
      // Funktion zum Generieren personalisierter Empfehlungen
      function generateRecommendations(data) {
        const container = document.getElementById('recommendations-list');
        if (!container) return;
        
        // Score bestimmen
